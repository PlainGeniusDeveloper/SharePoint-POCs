<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Section Editor with Banner and CKEditor</title>
    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .section {
            border: 1px solid #ccc;
            margin-bottom: 20px;
            padding: 10px;
            position: relative;
            background-color: #f9f9f9;
        }
        .banner-section {
            background-size: cover;
            color: white;
            padding: 20px;
            height: 200px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .banner-section h1 {
            margin: 0;
        }
        .banner-section h2 {
            margin: 5px 0 20px;
        }
        .banner-section .tools {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .tools button {
            margin-left: 5px;
            padding: 5px 10px;
        }
        .section .tools {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .section .tools button {
            margin-left: 5px;
            padding: 5px 10px;
        }
        #editor-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            z-index: 1000;
            width: 80%;
            max-width: 600px;
        }
        #editor-modal textarea {
            width: 100%;
            height: 150px;
        }
        #save-content, #cancel-edit, #add-section {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="banner-section section" style="background-image: url('https://via.placeholder.com/800x200');">
    <h1>Banner Title</h1>
    <h2>Banner Subtitle</h2>
    <a href="#" class="order-now-button" style="display: none;">Order Now</a>
    <div class="tools">
        <button class="edit">Edit</button>
    </div>
</div>

<div class="section">
    <h3>Summary Title</h3>
    <p>Summary description content.</p>
    <div class="tools">
        <button class="edit">Edit</button>
        <button class="delete">Delete</button>
    </div>
</div>

<button id="add-section">Add New Section</button>

<div id="editor-modal">
    <div class="input-group">
        <label for="section-title">Title:</label>
        <input type="text" id="section-title">
    </div>
    <div class="input-group">
        <label for="section-description">Description:</label>
        <textarea id="section-description"></textarea>
    </div>
    <div class="input-group">
        <label for="image-url">Image URL (for Banner):</label>
        <input type="text" id="image-url">
    </div>
    <div class="input-group">
        <label for="order-now-link">Order Now Link (for Banner):</label>
        <input type="text" id="order-now-link">
    </div>
    <button id="save-content">Save</button>
    <button id="cancel-edit">Cancel</button>
</div>

<script>
$(document).ready(function() {
    let currentSection = null;
    let editorInstance = null;

    // Initialize CKEditor
    function initEditor() {
        ClassicEditor
            .create(document.querySelector('#section-description'), {
                toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote', 'insertTable', 'mediaEmbed', 'undo', 'redo', 'imageUpload', 'imageInsert'],
                image: {
                    toolbar: ['imageTextAlternative', 'imageStyle:full', 'imageStyle:side', 'linkImage'],
                    insert: {
                        integrations: ['insertImageViaUrl']
                    }
                }
            })
            .then(editor => {
                editorInstance = editor;
            })
            .catch(error => {
                console.error(error);
            });
    }

    initEditor();

    // Function to open the editor modal for editing
    function openEditor(section) {
        currentSection = section;
        $('#section-title').val(section.find('h1, h2, h3').first().text());
        editorInstance.setData(section.find('p').html());
        
        if (section.hasClass('banner-section')) {
            $('#image-url').closest('.input-group').show();
            $('#order-now-link').closest('.input-group').show();
            $('#image-url').val(section.css('background-image').replace(/url\(|\)|"|'/g, ""));
            $('#order-now-link').val(section.find('.order-now-button').attr('href'));
        } else {
            $('#image-url').closest('.input-group').hide();
            $('#order-now-link').closest('.input-group').hide();
        }
        $('#editor-modal').show();
    }

    // Edit button click event
    $(document).on('click', '.edit', function() {
        let section = $(this).closest('.section');
        openEditor(section);
    });

    // Save button click event
    $('#save-content').click(function() {
        let title = $('#section-title').val();
        let description = editorInstance.getData();

        currentSection.find('h1, h2, h3').first().text(title);
        currentSection.find('p').html(description);

        if (currentSection.hasClass('banner-section')) {
            let imageUrl = $('#image-url').val();
            let orderNowLink = $('#order-now-link').val();

            currentSection.css('background-image', 'url(' + (imageUrl || 'https://via.placeholder.com/800x200') + ')');
            if (orderNowLink) {
                currentSection.find('.order-now-button').attr('href', orderNowLink).show();
            } else {
                currentSection.find('.order-now-button').hide();
            }
        }

        $('#editor-modal').hide();
    });

    // Cancel button click event
    $('#cancel-edit').click(function() {
        $('#editor-modal').hide();
    });

    // Add new section
    $('#add-section').click(function() {
        let newSection = $('<div class="section"><h3>New Title</h3><p>New description content.</p><div class="tools"><button class="edit">Edit</button><button class="delete">Delete</button></div></div>');
        $('#add-section').before(newSection);
    });

    // Delete button click event
    $(document).on('click', '.delete', function() {
        $(this).closest('.section').remove();
    });
});
</script>

</body>
</html>
