$(document).ready(function() {
    // Replace with your SharePoint site URL and list names
    var siteUrl = '/sites/yoursite';
    var configListName = 'Field Visibility Config';

    // Initialize Select2 on your dropdown if not already initialized
    $('select[title="Tab Required Field"]').select2();

    // Event handler for Select2 dropdown change
    $('select[title="Tab Required Field"]').on('select2:select', function(e) {
        var selectedTab = e.params.data.id; // Get selected tab value from Select2
        
        // Fetch configuration data
        $.ajax({
            url: siteUrl + "/_api/web/lists/getbytitle('" + configListName + "')/items?$filter=Tab eq '" + selectedTab + "'",
            type: 'GET',
            headers: {
                'Accept': 'application/json;odata=verbose'
            },
            success: function(data) {
                var results = data.d.results;

                // Reset visibility of all fields
                $('select[title]').show(); // Show all fields initially

                // Iterate through results and hide fields as per configuration
                $.each(results, function(index, item) {
                    var fieldName = item.FieldName; // Field name from the configuration
                    var fieldSelector = "select[title='" + fieldName + "']"; // Selector based on the title attribute
                    $(fieldSelector).hide(); // Hide field
                });
            },
            error: function(error) {
                console.log("Error fetching data: " + JSON.stringify(error));
            }
        });
    });
});
