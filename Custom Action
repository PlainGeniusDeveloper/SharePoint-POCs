<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        console.log("Document ready. Waiting for SP.js and SP.Ribbon.js to load...");
        SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function() {
            console.log("SP.js loaded.");
            SP.SOD.executeFunc('sp.ribbon.js', 'SP.Ribbon.PageManager', function() {
                console.log("SP.Ribbon.js loaded.");
                ensureRibbon();
            });
        });
    });

    function ensureRibbon() {
        console.log("Ensuring ribbon is available...");
        var ribbon = SP.Ribbon.PageManager.get_instance().get_ribbon();
        if (!ribbon) {
            console.log("Ribbon not available yet. Waiting...");
            setTimeout(ensureRibbon, 500); // Wait and check again
        } else {
            console.log("Ribbon is available. Customizing...");
            addCustomButton();
        }
    }

    function addCustomButton() {
        var ribbon = SP.Ribbon.PageManager.get_instance().get_ribbon();
        var tab = ribbon.getChildByTitle("Items");

        if (tab == null) {
            console.log("Items tab not found. Waiting...");
            setTimeout(addCustomButton, 500); // Wait and check again
            return;
        }

        var section = new CUI.Group({
            id: "CustomGroup",
            title: "Custom Group",
            description: "Custom Group",
            command: null,
            sequence: 1000,
            template: null
        });

        var button = new CUI.Controls.Button({
            id: "CustomButton",
            title: "Custom Button",
            description: "Click to perform custom action",
            command: "CustomButtonCommand",
            image16by16: "/_layouts/15/images/placeholder16x16.png",
            image32by32: "/_layouts/15/images/placeholder32x32.png",
            sequence: 1000,
            templateAlias: "o1"
        });

        section.addChild(button);
        tab.addChild(section);

        SP.Ribbon.PageManager.get_instance().get_ribbon().refresh();
        console.log("Custom button added to ribbon.");
    }

    function customButtonAction() {
        alert('Custom button clicked!');
    }
</script>
