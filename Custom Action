<script type="text/javascript">
    function addCustomRibbonAction() {
        var ribbonMenu = document.querySelector('#Ribbon\\.EditingTools\\.CPInsert .ms-cui-tts');
        if (ribbonMenu) {
            // Check if the dropdown already exists to avoid duplicate additions
            if (!document.getElementById('customTableInsertDropdown')) {
                var newGroup = document.createElement('li');
                newGroup.className = 'ms-cui-tt ms-cui-tt-medium ms-cui-tt-split';
                newGroup.innerHTML = `
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="customTableInsertDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Insert Table
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="customTableInsertDropdown">
                            <li><a class="dropdown-item" href="javascript:;" data-table-url="https://yoursharepointsite.com/path/to/tableTemplate1.html">Table 1</a></li>
                            <li><a class="dropdown-item" href="javascript:;" data-table-url="https://yoursharepointsite.com/path/to/tableTemplate2.html">Table 2</a></li>
                            <li><a class="dropdown-item" href="javascript:;" data-table-url="https://yoursharepointsite.com/path/to/tableTemplate3.html">Table 3</a></li>
                        </ul>
                    </div>
                `;
                ribbonMenu.appendChild(newGroup);

                // Attach click events to the dropdown options
                var options = document.querySelectorAll('.dropdown-item');
                options.forEach(option => {
                    option.addEventListener('click', function(event) {
                        event.preventDefault();
                        insertTable(this.getAttribute('data-table-url'));
                    });
                });

                console.log("Custom dropdown added successfully.");
            }
        } else {
            console.error('Ribbon menu not found.');
        }
    }

    function captureInsertTitleClick() {
        var insertTitle = document.getElementById('Ribbon.EditingTools.CPInsert-Title');
        if (insertTitle) {
            insertTitle.addEventListener('click', function() {
                console.log('Insert title clicked');
                addCustomRibbonAction(); // Add custom ribbon action when the Insert tab is clicked
            });
        } else {
            console.error('Insert title not found.');
        }
    }

    function insertTable(tableHtmlUrl) {
        fetch(tableHtmlUrl)
            .then(response => response.text())
            .then(data => {
                var richTextField = document.querySelector('.ms-rtestate-field'); // Adjust selector as per your form field
                if (richTextField) {
                    insertHTMLAtCursor(richTextField, data);
                } else {
                    alert("Rich text field not found!");
                }
            })
            .catch(error => {
                console.error('Error loading the table template:', error);
            });
    }

    function insertHTMLAtCursor(el, html) {
        var range, sel;
        if (window.getSelection) {
            sel = window.getSelection();
            if (sel.getRangeAt && sel.rangeCount) {
                range = sel.getRangeAt(0);
                range.deleteContents();
                var fragment = range.createContextualFragment(html);
                range.insertNode(fragment);
                range.collapse(false);
            }
        } else if (document.selection && document.selection.createRange) {
            document.selection.createRange().pasteHTML(html);
        }
    }

    function observeRibbon() {
        // Create a MutationObserver to watch for changes in the DOM
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                var ribbonMenu = document.querySelector('#Ribbon\\.EditingTools\\.CPInsert .ms-cui-tts');
                if (ribbonMenu) {
                    addCustomRibbonAction();
                    captureInsertTitleClick(); // Capture click event on Insert Title
                }
            });
        });

        // Start observing the document body for changes
        observer.observe(document.body, { childList: true, subtree: true });
    }

    // Initialize MutationObserver to watch for changes in the ribbon
    document.addEventListener('DOMContentLoaded', function() {
        observeRibbon();
    });
</script>



<style>
    .dropdown-toggle {
        display: inline-block;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        user-select: none;
        background-color: #6c757d;
        border: 1px solid transparent;
        border-radius: 0.25rem;
        color: #fff;
        text-decoration: none;
    }
    
    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        display: none;
        float: left;
        min-width: 10rem;
        padding: 0.5rem 0;
        margin: 0.125rem 0 0;
        font-size: 1rem;
        color: #212529;
        text-align: left;
        list-style: none;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-radius: 0.25rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.175);
    }
    
    .dropdown-item {
        display: block;
        width: 100%;
        padding: 0.25rem 1.5rem;
        clear: both;
        font-weight: 400;
        color: #212529;
        text-align: inherit;
        text-decoration: none;
        white-space: nowrap;
        background-color: transparent;
        border: 0;
    }
    
    .dropdown-item:hover {
        color: #16181b;
        text-decoration: none;
        background-color: #f8f9fa;
    }
</style>
